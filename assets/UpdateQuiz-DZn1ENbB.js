import{f as e,u as s,r as t,j as n}from"./vendor-react-B9slfjkH.js";/* empty css             */import{L as i}from"./main-C1RESi2Z.js";import{B as r,l as a}from"./vendor-CQ7Um5D1.js";import{M as u}from"./MathRender-CkNMaa3x.js";import"./vendor-katex-7i1KP8HX.js";function o(){const o=e(),l=s(),c=t.useRef(),d=t.useRef(),p=t.useRef(),q=t.useRef([]),h=t.useRef([]),m=t.useRef([]),[_,f]=t.useState(!0),[x,v]=t.useState({}),[j,g]=t.useState({}),[z,w]=t.useState({0:0}),[$,N]=t.useState([]),[b,y]=t.useState({}),[L,D]=t.useState({}),[S,C]=t.useState(!1),[E,Q]=t.useState(!1);function R(e,s){g((s=>({...s,[`questions.${e}.question_image`]:void 0})));let t;if(["image/png","image/jpeg","image/jpg"].includes(s.type)||(t="Allowed formats: PNG, JPG, JPEG"),s.size>4194304&&(t="Image must be less than 4MB"),/\..+\./.test(s.name)&&(t="Invalid file name format"),t)return g((s=>({...s,[`questions.${e}.question_image`]:t})));const n=URL.createObjectURL(s);y((s=>({...s,[e]:n}))),D((t=>({...t,[e]:s})))}function P(e){e.preventDefault(),C(!0)}function k(e){e.preventDefault(),C(!1)}return t.useEffect((()=>{(async()=>{await a.get(`/quizzes/${o.quiz}`).then((e=>{var s;v(e.data.quiz),N(e.data.quiz.quiz_questions||[]);const t={};null==(s=e.data.quiz.quiz_questions)||s.forEach(((e,s)=>{var n;null==(n=e.question_answers)||n.forEach(((e,n)=>{1===e.correct_answer&&(t[s]=n)})),y((s=>({...s,[e.quiz_question_id]:e.question_image})))})),w(t),f(!1)}))})()}),[o]),_?n.jsx(i,{}):n.jsx(n.Fragment,{children:n.jsx("div",{className:"form",children:n.jsxs("div",{className:"container",children:[n.jsx("div",{className:"header",children:n.jsx("h1",{children:"Update Quiz"})}),n.jsxs("form",{children:[n.jsxs("div",{children:[n.jsx("label",{children:"Quiz title"}),n.jsx("input",{ref:c,type:"text",placeholder:"Title",pattern:"/^[\\p{L}\\p{N}\\p{S}\\p{P}\\s]{3,50}$/u",minLength:3,maxLength:50,defaultValue:x.quiz_title}),j.quiz_title&&n.jsx("p",{className:"error",children:j.quiz_title})]}),n.jsxs("div",{children:[n.jsx("label",{children:"Quiz description"}),n.jsx("textarea",{ref:d,placeholder:"Description",defaultValue:x.quiz_description,pattern:"/^[\\p{L}\\p{N}\\p{S}\\p{P}\\s]{3,150}$/u",maxLength:100}),j.quiz_description&&n.jsx("p",{className:"error",children:j.quiz_description})]}),n.jsxs("div",{children:[n.jsx("label",{children:"Quiz difficulty"}),n.jsxs("select",{ref:p,defaultValue:x.quiz_difficulty,children:[n.jsx("option",{value:"1",children:"Easy"}),n.jsx("option",{value:"2",children:"Medium"}),n.jsx("option",{value:"3",children:"Hard"})]}),j.quiz_difficulty&&n.jsx("p",{className:"error",children:j.quiz_difficulty})]}),null==$?void 0:$.map(((e,s)=>{var t,i;const a=e.quiz_question_id||e.temp_id;return n.jsxs("div",{className:"question-card",children:[n.jsxs("div",{className:"question-header",children:[n.jsxs("h3",{children:["Question ",s+1]}),n.jsx("h3",{className:"delete",onClick:()=>{!function(e){if($.length>1){const s=$[e].quiz_question_id||$[e].temp_id;N((s=>s.filter(((s,t)=>t!==e)))),y((e=>{const{[s]:t,...n}=e;return n})),D((e=>{const{[s]:t,...n}=e;return n})),w((s=>{const t={};return Object.entries(s).forEach((([s,n])=>{const i=Number(s);i<e&&(t[i]=n),i>e&&(t[i-1]=n)})),t}))}else g({questions_limit:"You can't create a quiz without questions"})}(s)},children:"X"})]}),n.jsxs("div",{children:[n.jsx("label",{children:"Question Description"}),n.jsx("textarea",{placeholder:"Question Description (use $...$ for math equations)",defaultValue:e.question_description,required:!0,pattern:"^[\\p{L}\\p{N}\\p{S}\\p{P}\\s\\^\\_\\$\\\\\\/\\(\\)\\{\\}\\+=]{3,100}$",minLength:3,maxLength:100,ref:e=>q.current[s]=e,onChange:e=>{const t=r.sanitize(e.target.value).replace(/</g,"&lt;").replace(/>/g,"&gt;");e.target.value=t,g((e=>({...e,[`questions.${s}.question_description`]:void 0})))}}),j[`questions.${s}.question_description`]&&n.jsx("p",{className:"error",children:j[`questions.${s}.question_description`]}),n.jsx("div",{className:"math-preview",children:n.jsx(u,{content:(null==(t=q.current[s])?void 0:t.value)||""})})]}),n.jsxs("div",{children:[n.jsx("label",{children:"Question Image (Optional)"}),n.jsxs("label",{id:"file-upload",className:`upload-box ${b[a]?"success":""} ${j[`questions.${s}.question_image`]?"error":""} ${S?"active":""}`,onDragOver:P,onDragLeave:k,onDrop:e=>function(e,s){e.preventDefault(),C(!1);const t=e.dataTransfer.files[0];t&&R(s,t)}(e,a),children:[n.jsx("img",{src:b[a]||"/upload-image.svg",alt:"",ref:e=>m.current[a]=e}),n.jsx("input",{type:"file",accept:"image/*",className:"image-upload",hidden:!0,onChange:e=>R(a,e.target.files[0])}),n.jsx("p",{children:"Drag & drop or Browse File to Upload"})]}),j[`questions.${s}.question_image`]&&n.jsx("p",{className:"error",children:j[`questions.${s}.question_image`]})]}),n.jsxs("div",{className:"answers-section",children:[n.jsx("h4",{children:"Answers"}),null==(i=e.question_answers)?void 0:i.map(((e,t)=>{var i,a,o,l;return n.jsxs("div",{className:"answer-input",children:[n.jsx("label",{children:"Answer text"}),n.jsx("input",{type:"text",placeholder:"Answer text (use ^ for exponents, _ for subscripts)",required:!0,minLength:3,maxLength:50,defaultValue:e.question_answer_text,onChange:e=>{const s=r.sanitize(e.target.value).replace(/</g,"&lt;").replace(/>/g,"&gt;");e.target.value=s,N((e=>[...e]))},ref:e=>{h.current[s]||(h.current[s]=[]),h.current[s][t]=e}}),j[`questions.${s}.answers.${t}.question_answer_text`]&&n.jsx("p",{className:"error",children:j[`questions.${s}.answers.${t}.question_answer_text`]}),n.jsxs("label",{children:["Correct:",n.jsx("input",{type:"checkbox",checked:z[s]===t,onChange:()=>function(e,s){g((t=>({...t,[`questions.${e}.answers.${s}.correct_answer`]:void 0}))),w((t=>({...t,[e]:s})))}(s,t)}),j[`questions.${s}.answers.${t}.correct_answer`]&&n.jsx("p",{className:"error",children:j[`questions.${s}.answers.${t}.correct_answer`]})]}),n.jsx("div",{className:"math-preview",children:n.jsx(u,{content:(null==(a=null==(i=h.current[s])?void 0:i[t])?void 0:a.value)||""},null==(l=null==(o=h.current[s])?void 0:o[t])?void 0:l.value)})]},e.question_answer_id||t)}))]})]},a)})),j.questions_limit&&n.jsx("p",{className:"error",children:j.questions_limit}),n.jsxs("button",{type:"button",onClick:function(){$.length<50?(g((e=>({...e,questions_limit:void 0}))),N((e=>{const s={temp_id:Date.now(),question_answers:Array(4).fill().map((()=>({question_answer_text:"",correct_answer:0})))};return w((s=>({...s,[e.length]:0}))),[...e,s]}))):g((e=>({...e,questions_limit:"You can only add up to 50 questions per quiz"})))},children:["Add Question(",$.length," / ",50,")"]}),n.jsx("button",{disabled:E,onClick:e=>async function(e){e.preventDefault(),Q(!0);const s=new FormData;c.current.value&&s.append("quiz_title",c.current.value),d.current.value&&s.append("quiz_description",d.current.value),p.current.value&&s.append("quiz_difficulty",p.current.value),s.append("_method","PUT"),$.forEach(((e,t)=>{var n;const i=e.quiz_question_id||e.temp_id;s.append(`questions[${t}][quiz_question_id]`,e.quiz_question_id||""),s.append(`questions[${t}][question_description]`,(null==(n=q.current[t])?void 0:n.value)||""),L[i]&&s.append(`questions[${t}][question_image]`,L[i],`question_${t}_image`),e.question_answers.forEach(((e,n)=>{var i,r;const a=(null==(r=null==(i=h.current[t])?void 0:i[n])?void 0:r.value)||"",u=z[t]===n?"1":"0";s.append(`questions[${t}][answers][${n}][question_answer_id]`,e.question_answer_id||""),s.append(`questions[${t}][answers][${n}][question_answer_text]`,a),s.append(`questions[${t}][answers][${n}][correct_answer]`,u)}))})),a.post(`/quizzes/${o.quiz}`,s,{headers:{"Content-Type":"multipart/form-data"}}).then((()=>{l("/dashboard/quizzes")})).catch((e=>{var s,t;if(null==(t=null==(s=e.response)?void 0:s.data)?void 0:t.errors){const s={};Object.entries(e.response.data.errors).forEach((([e,t])=>{s[e]=t[0]})),g(s)}})).finally((()=>{Q(!1)}))}(e),children:E?"Loading...":"Update quiz"})]})]})})})}export{o as default};
